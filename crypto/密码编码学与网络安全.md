## 分组密码与数据加密标准

### 分组密码原理

#### feistel密码

##### 设计动机

###### 简单代换密码

分组密码结构：n位明文组 -> n位映射 -> n位密文组

n小->抗分析性弱，n大->抗分析性强

若直接由密钥定义映射表，则对于n位的代换分组，密钥规模为n*2^n位，其中有2^n种映射，每种映射n位，显然不可行

###### 线性密码

而对于由指定参数生成的映射集，因为其是线性的，所以也很好攻破，如

```
y1 = k11x1 + k12x2
y2 = k21x1 + k22x2
```

可以由逆矩阵直接解密（Hill密码）

##### feistel密码

###### 混淆和扩散

* **扩散** 消除**密文**中**明文**的统计特征
* **混淆** 消除**密文和密钥**的统计关系

###### 密码结构

代换置换网络

**加密**

* 明文分为左(l)右(r)两半
* l(i) = r(i-1)
* r(i) = l(i-1) ^ F( r(i-1),K(i-1) )

**解密**

算法相同，密钥顺序相反

##### 加解密原理

因为加密时有

```
l(i) = r(i-1)
r(i) = l(i-1) ^ F( r(i-1),k(i-1) )
```

而密文为

```
l(n) || r(n)
```

所以解密第一轮

```
r(n-1) = l(n)
l(n-1) = r(n) ^ F( l(n),k(n-1) )
```

此时得到的r(n-1)和l(n-1)与加密时的相同，则继续迭代这个过程

#### DES

##### 整体结构

分组长度：64位

密钥长度：64位（其中每个字节的最后一位没用），实际使用56位

```
	plain_text
    	|
    	IP			64->64
  l(0)  |  r(0)		32 | 32
   |	  / |
   |	/  F(r(0),k(0))
   |   /    |
   ---/-----+
     /      |
  l(i+1)   r(i+1)
   |        |
      ...
   |        |
  l(n)     r(n)
   |________|
        |
       IPr
        |
   cipher_text
```

##### 密钥扩展

```
          key          64
           |
          PC1          64->56
           |
     l(0)  |    r(0)   28|28
     |           |
  lsh(1)       lsh(1)
     |           |
 lsh(x[0])   lsh(x[0])
     |           |
     |--->PC2<---|     56->48
     |     |     |
 k0--|-----|     |
     |           |
     l(1)       r(1)
     |           |
          ...
```

##### F

```
            r(i)        32
             |
             E          32->48
             |
             +---ki     48
    _________|__________
   |  |  |  |  |  |  |  |   8*6
  s1 s2 s3 s4 s5 s6 s7 s8   6->4
   |  |  |  |  |  |  |  |
   ----------------------   8*4
             |
             P          32->32
```

#### 攻击

##### 差分密码分析

###### 攻击点

使用同一密钥k加密P和P*，对于P和P\*差异导致的密文T和T\*差异是伪随机均匀的，但对于P'=P^P\*导致的T'=T^T\*不均匀

###### 原理

因为对于feistel结构，有

```
l(i) = r(i-1)
r(i) = l(i-1) ^ F(r(i-1),k(i))
```

所以每次仅改变一半的位数，且

```
r(i) = r(i-2) ^ F(r(i-1),k(i-1))
```

若已知明文m和m'的异或差分△m，考虑加密中间的数据差分

```
△mi = mi ^ m'i
    = (m(i-2) ^ F(m(i-1),k(i-1))) ^ (m'(i-2) ^ F(m'(i-1),k(i-1)))
    = △m(i-2) ^ ( F(m(i-1),k(i-1)) ^ F(m'(i-1),k(i-1)) )
```

若函数f有很多对相同差分的输入，若差分为X的所有输入产生差分为Y的输出占所有输出的百分比为p，称为差分X导致差分Y的概率为p，

###### 概率

* 输入S盒的**6bit值对(x,x\*)**共有 **64^2 = 4096** 种可能
* **输入值对差分**为 x'=x^x\* 共有 **2^6 = 64** 种值
* **输出值对差分**为 y'=S(x)^S(x\*) 共有 **2^4=16** 种值

